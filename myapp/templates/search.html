{% extends "base.html" %}
{% block title %}Search To Add{% endblock %}

{% block style %}
    {{ super() }}
    <link href="{{ url_for('static', filename='css/search.css') }}" rel="stylesheet"/>
{% endblock %}

{% block content %}

    <!-- Search Bar -->

    <form method="POST" action="{{ url_for('main.search') }}" class="row search-bar align-items-center" novalidate>
        
        {{ form.hidden_tag() }} <!-- CSRF token -->

        <div class="col-12 col-md-6 mb-2">
            {{ form.q(class="form-control", placeholder="Search by title...") }}
            {% for error in form.q.errors %}
                <div class="text-danger small">*{{ error }}</div>
            {% endfor %}
        </div>

        <div class="col-12 col-md-3 mb-2">
            <select name="{{ form.status.name }}" class="form-select">
                <option value="all" {% if request.args.get('status') == 'all' %}selected{% endif %}>All</option>
                <option value="movie" {% if request.args.get('status') == 'movie' %}selected{% endif %}>Movie</option>
                <option value="series" {% if request.args.get('status') == 'series' %}selected{% endif %}>Web Series</option>
            </select>
        </div>

        <div class="col-12 col-md-3 mb-2 text-end">
            {{ form.submit(class="btn btn-primary w-100") }}
        </div>

    </form>


    <!-- Results Grid -->
    <div class="row g-4" id="resultsGrid">
        {% for item in results %}
            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                <div class="item-card">
                    {% if item.poster_path %}
                        <img src="https://image.tmdb.org/t/p/w200{{ item.poster_path }}" 
                            alt="{{ item.title or item.name }}">
                    {% else %}
                        <img src="https://picsum.photos/200/300?random={{ loop.index }}" 
                            alt="{{ item.title or item.name }}">
                    {% endif %}

                    <h5>{{ item.title or item.name }}</h5>

                    <span class="status-badge {% if item.media_type == 'movie' %}status-movie{% else %}status-series{% endif %}">
                        {% if item.media_type == 'movie' %}Movie{% else %}Web Series{% endif %}
                    </span>

                    <p>
                        Release: {{ item.formatted_date }} |
                        ‚≠ê {{ item.vote_average or "N/A" }} ({{ item.vote_count or 0 }})
                    </p>
                    <!-- <a href="#" class="btn btn-sm btn-outline-primary">Add to Watchlist</a> -->
                    
                    <form method="POST" action="{{ url_for('main.add_to_wishlist') }}">

                        <input type="hidden" name="tmdb_id" value="{{ item.id }}">
                        <input type="hidden" name="media_type" value="{{ item.media_type }}">
                        <input type="hidden" name="title" value="{{ item.title or item.name }}">
                        <input type="hidden" name="release_date" value="{{ item.release_date or item.first_air_date }}">
                        <input type="hidden" name="poster_path" value="{{ item.poster_path }}">
                        <input type="hidden" name="overview" value="{{ item.overview }}">
                        <input type="hidden" name="rating" value="{{ item.vote_average }}">
                        <input type="hidden" name="vote_count" value="{{ item.vote_count }}">
                        <input type="hidden" name="original_language" value="{{ item.original_language }}">
                        <input type="hidden" name="popularity" value="{{ item.popularity }}">

                        <button type="submit" class="btn btn-sm btn-outline-primary">Add to Watchlist</button>
                    </form>

                </div>
            </div>
        {% endfor %}
    </div>

    <!-- Pagination / Load More -->
    {% if results %}
        <nav aria-label="Search pagination">
            <ul class="pagination justify-content-center mt-4">
                {% for p in range(1, total_pages + 1) %}
                    <li class="page-item {% if p == page %}active{% endif %}">
                        <a class="page-link"
                            href="{{ url_for('main.search', q=query, status=status, page=p) }}">
                            {{ p }}
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </nav>
    {% endif %}


{% endblock %}
