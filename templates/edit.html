{% extends "base.html" %}
{% block title %} Edit {{ item.title }}{% endblock %}

{% block style %}
    {{ super() }}
    <link href="{{ url_for('static', filename='css/edit.css') }}" rel="stylesheet"/>
{% endblock %}

{% block content %}

<div class="container mt-5">
    <div class="row">
        <!-- Left: Poster Image -->
        <div class="col-md-4 text-center">
            <img src="{{ item.poster_path or 'https://picsum.photos/200/300' }}" 
                 alt="{{ item.title }}" class="img-fluid rounded shadow-sm">
        </div>

        <!-- Right: Item Details -->
        <div class="col-md-8">
            <h2>{{ item.title }}</h2>
            <p><strong>Media Type:</strong> {{ item.media_type|capitalize }}</p>
            <p><strong>Release Date:</strong> {{ item.release_date or 'N/A' }}</p>
            <p><strong>Overview:</strong> {{ item.overview or 'N/A' }}</p>
            <p><strong>Rating:</strong> ‚≠ê {{ item.rating or 'N/A' }}</p>
            <p><strong>Vote Count:</strong> {{ item.vote_count or 'N/A' }}</p>
            <p><strong>Original Language:</strong> {{ item.original_language or 'N/A' }}</p>
            <p><strong>Popularity:</strong> {{ item.popularity or 'N/A' }}</p>
            <p>
                <strong>Status:</strong>
                <span class="status-badge status-{{ item.status }}">
                    {{ "Watched" if item.status=="watched" else "Want to Watch" }}
                </span>
            </p>
            <p><strong>Your Rating:</strong> {{ item.user_rating or 'N/A' }}</p>
            <p><strong>Notes:</strong> {{ item.notes or 'N/A' }}</p>

            <!-- Edit Button -->
            <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#editModal">
                Edit
            </button>
            <!-- Delete Button -->
            <button class="btn btn-danger mt-3" data-bs-toggle="modal" data-bs-target="#deleteModal">
                Delete
            </button>
            <!-- Cancel Button -->
            <a href="{{ url_for('dashboard', media_type=item.media_type) }}" class="btn btn-secondary mt-3">
                Cancel
            </a>

        </div>
    </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

        <form method="POST" action="{{ url_for('edit_item', item_id=item.id) }}">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Edit {{ item.title }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="status" class="form-label">Status</label>
                    <select class="form-select" name="status" id="status">
                        <option value="towatch" {% if item.status=="towatch" %}selected{% endif %}>Want to Watch</option>
                        <option value="watched" {% if item.status=="watched" %}selected{% endif %}>Watched</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="user_rating" class="form-label">Your Rating</label>
                    <input type="number" step="0.1" max="10" min="0" class="form-control" name="user_rating" 
                        id="user_rating" value="{{ item.user_rating or '' }}">
                </div>
                <div class="mb-3">
                    <label for="notes" class="form-label">Notes</label>
                    <textarea class="form-control" name="notes" id="notes" rows="3">{{ item.notes or '' }}</textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </form>
    </div>
  </div>
</div>


<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete "{{ item.title }}" from your wishlist?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <a href="{{ url_for('delete_item', item_id=item.id) }}" class="btn btn-danger">Delete</a>
            </div>
        </div>
    </div>
</div>

{% endblock %}
