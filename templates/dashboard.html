{% extends "base.html" %}
{% block title %}Movies Dashboard{% endblock %}

{% block style %}
    {{ super() }}
    <link href="{{ url_for('static', filename='css/dashboard.css') }}" rel="stylesheet"/>
{% endblock %}

{% block content %}

    <!-- Add New Button centered -->
    <div class="text-center mb-4">
        <a href="{{ url_for('search', status=media_type) }}" class="btn btn-primary btn-lg">
            + Add New {{ media_type|capitalize }}
        </a>
    </div>

    <!-- Filter & Search Bar -->
    <div class="row filter-bar align-items-center">
        <form method="GET" action="{{ url_for('dashboard', media_type=media_type) }}" class="col-12 row g-2">
            <!-- Search input -->
            <div class="col-md-6 mb-2">
                <input type="text" name="q" class="form-control" placeholder="Search by title..." value="{{ request.args.get('q', '') }}">
            </div>

            <!-- Status select -->
            <div class="col-md-2 mb-2">
                <select name="status" class="form-select">
                    <option value="">All Status</option>
                    <option value="watched" {% if request.args.get('status')=="watched" %}selected{% endif %}>Watched</option>
                    <option value="towatch" {% if request.args.get('status')=="towatch" %}selected{% endif %}>Want to Watch</option>
                </select>
            </div>

            <!-- Sort select -->
            <div class="col-md-2 mb-2">
                <select name="sort" class="form-select">
                    <option value="">Sort By</option>
                    <option value="rating" {% if request.args.get('sort')=="rating" %}selected{% endif %}>Rating</option>
                    <option value="date_added" {% if request.args.get('sort')=="date_added" %}selected{% endif %}>Date Added</option>
                    <option value="title" {% if request.args.get('sort')=="title" %}selected{% endif %}>Title</option>
                </select>
            </div>

            <!-- Apply button -->
            <div class="col-md-2 mb-2 text-end">
                <button type="submit" class="btn btn-primary w-100">Apply</button>
            </div>
        </form>
    </div>


    <!-- Cards Grid -->
    <div class="row g-4">
        {% for item in items.items %}
            <div class="col-md-3 col-sm-6">
                <div class="item-card">
                    <a href="{{ url_for('edit_item', item_id=item.id) }}" class="text-decoration-none item-card-link">
                        <img src="{{ item.poster_path or 'https://picsum.photos/200/300' }}" alt="{{ item.title }}">
                        <h5>{{ item.title }}</h5>
                    </a>
                    <span class="status-badge status-{{ item.status }}">{{ "Watched" if item.status=="watched" else "Want to Watch" }}</span>
                    <div class="rating">‚≠ê {{ item.rating }}</div>
                    <div class="mt-2">
                        <a href="{{ url_for('edit_item', item_id=item.id) }}" class="btn btn-sm btn-outline-primary">Edit</a>
                        <a href="#" class="btn btn-sm btn-outline-danger">Delete</a>        
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>


    <!-- Pagination -->
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">
            {% if items.has_prev %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('dashboard', media_type=media_type, page=items.prev_num, q=q, status=status_filter, sort=sort_by) }}">Previous</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">Previous</span></li>
            {% endif %}

            {% for p in range(1, items.pages + 1) %}
                <li class="page-item {% if p == items.page %}active{% endif %}">
                    <a class="page-link" href="{{ url_for('dashboard', media_type=media_type, page=p, q=q, status=status_filter, sort=sort_by) }}">{{ p }}</a>
                </li>
            {% endfor %}

            {% if items.has_next %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('dashboard', media_type=media_type, page=items.next_num, q=q, status=status_filter, sort=sort_by) }}">Next</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">Next</span></li>
            {% endif %}
        </ul>
    </nav>


{% endblock %}